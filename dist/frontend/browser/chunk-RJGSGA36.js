import{a as D}from"./chunk-UYIQI5J7.js";import{a as A}from"./chunk-7O5VV4DI.js";import{B as s,E as C,G as N,K as g,T as d,U as o,V as a,W as S,X as u,Y as O,Z as l,_ as I,aa as f,ba as M,ca as E,d as v,j as b,l as y,pa as T,qa as k,sa as w,t as _,u as p,za as L}from"./chunk-WWV2B3DV.js";function $(t,c){if(t&1){let e=u();o(0,"button",9),O("click",function(){_(e);let i=l();return p(i.marcarTodasComoLeidas())}),f(1," Marcar todas como le\xEDdas "),a()}}function z(t,c){t&1&&(o(0,"div",10)(1,"p"),f(2,"Cargando notificaciones..."),a()())}function R(t,c){if(t&1&&(o(0,"div",11),f(1),a()),t&2){let e=l();s(),E(" ",e.errorMessage," ")}}function V(t,c){t&1&&(o(0,"div",12)(1,"p"),f(2,"No tienes notificaciones"),a()())}function j(t,c){if(t&1){let e=u();o(0,"button",27),O("click",function(){_(e);let i=l().$implicit,r=l(2);return p(r.marcarComoLeida(i))}),f(1," Marcar como le\xEDda "),a()}}function F(t,c){t&1&&S(0,"div",28)}function H(t,c){if(t&1){let e=u();o(0,"div",15)(1,"div",16)(2,"span",17),f(3),a()(),o(4,"div",18)(5,"div",19)(6,"p",20),f(7),a(),o(8,"span",21),f(9),a()(),o(10,"div",22),g(11,j,2,0,"button",23),o(12,"button",24),O("click",function(){let i=_(e).$implicit,r=l(2);return p(r.eliminarNotificacion(i))}),f(13," Eliminar "),a()()(),o(14,"div",25),g(15,F,1,0,"div",26),a()()}if(t&2){let e=c.$implicit,n=l(2);I("no-leida",!e.leida)("leida",e.leida),s(3),M(n.getTipoIcono(e.tipo)),s(4),M(e.mensaje),s(2),M(n.formatearFecha(e.fechaCreacion)),s(2),d("ngIf",!e.leida),s(4),d("ngIf",!e.leida)}}function U(t,c){if(t&1&&(o(0,"div",13),g(1,H,16,9,"div",14),a()),t&2){let e=l();s(),d("ngForOf",e.notificaciones)}}var W=(()=>{let c=class c{constructor(n,i,r){this.notificacionService=n,this.usuarioService=i,this.router=r,this.notificaciones=[],this.usuario=null,this.isLoading=!1,this.errorMessage="",this.destroy$=new v}ngOnInit(){if(this.usuario=this.usuarioService.getCurrentUser(),!this.usuario){this.router.navigate(["/login"]);return}this.cargarNotificaciones(),b(3e4).pipe(y(this.destroy$)).subscribe(()=>{this.cargarNotificaciones()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarNotificaciones(){this.usuario&&(this.isLoading=!0,this.errorMessage="",this.notificacionService.obtenerPorUsuario(this.usuario.id).subscribe({next:n=>{this.notificaciones=n,this.isLoading=!1},error:n=>{console.error("Error al cargar notificaciones:",n),this.errorMessage="Error al cargar las notificaciones",this.isLoading=!1}}))}marcarComoLeida(n){n.leida||this.notificacionService.marcarComoLeida(n.id).subscribe({next:()=>{n.leida=!0;let i=this.notificacionService.getNotificacionesNoLeidasCount();i>0&&this.notificacionService.actualizarContadorNoLeidas(i-1)},error:i=>{console.error("Error al marcar notificaci\xF3n como le\xEDda:",i)}})}marcarTodasComoLeidas(){this.usuario&&this.notificacionService.marcarTodasComoLeidas(this.usuario.id).subscribe({next:()=>{this.notificaciones.forEach(n=>n.leida=!0)},error:n=>{console.error("Error al marcar todas como le\xEDdas:",n)}})}eliminarNotificacion(n){this.notificacionService.eliminar(n.id).subscribe({next:()=>{if(this.notificaciones=this.notificaciones.filter(i=>i.id!==n.id),!n.leida){let i=this.notificacionService.getNotificacionesNoLeidasCount();i>0&&this.notificacionService.actualizarContadorNoLeidas(i-1)}},error:i=>{console.error("Error al eliminar notificaci\xF3n:",i)}})}getTipoIcono(n){switch(n){case"TRANSACCION_DEPOSITO":return"\u{1F4B0}";case"TRANSACCION_RETIRO":return"\u{1F4B8}";case"SALDO_BAJO":return"\u26A0\uFE0F";default:return"\u{1F4E2}"}}getTipoColor(n){switch(n){case"TRANSACCION_DEPOSITO":return"success";case"TRANSACCION_RETIRO":return"warning";case"SALDO_BAJO":return"error";default:return"info"}}formatearFecha(n){let i=new Date(n),P=new Date().getTime()-i.getTime(),m=Math.floor(P/6e4),x=Math.floor(P/36e5),h=Math.floor(P/864e5);return m<1?"Ahora mismo":m<60?`Hace ${m} minuto${m>1?"s":""}`:x<24?`Hace ${x} hora${x>1?"s":""}`:h<7?`Hace ${h} d\xEDa${h>1?"s":""}`:i.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}hayNotificacionesNoLeidas(){return this.notificaciones.some(n=>!n.leida)}};c.\u0275fac=function(i){return new(i||c)(C(D),C(A),C(L))},c.\u0275cmp=N({type:c,selectors:[["app-notificaciones"]],decls:11,vars:5,consts:[[1,"notificaciones-container"],[1,"notificaciones-header"],[1,"header-actions"],["class","btn-marcar-todas",3,"click",4,"ngIf"],[1,"notificaciones-content"],["class","loading",4,"ngIf"],["class","error-message",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","notificaciones-list",4,"ngIf"],[1,"btn-marcar-todas",3,"click"],[1,"loading"],[1,"error-message"],[1,"empty-state"],[1,"notificaciones-list"],["class","notificacion-item",3,"no-leida","leida",4,"ngFor","ngForOf"],[1,"notificacion-item"],[1,"notificacion-icon"],[1,"icon"],[1,"notificacion-content"],[1,"notificacion-header"],[1,"mensaje"],[1,"fecha"],[1,"notificacion-actions"],["class","btn-marcar-leida",3,"click",4,"ngIf"],[1,"btn-eliminar",3,"click"],[1,"notificacion-status"],["class","unread-indicator",4,"ngIf"],[1,"btn-marcar-leida",3,"click"],[1,"unread-indicator"]],template:function(i,r){i&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),f(3,"Notificaciones"),a(),o(4,"div",2),g(5,$,2,0,"button",3),a()(),o(6,"div",4),g(7,z,3,0,"div",5)(8,R,2,1,"div",6)(9,V,3,0,"div",7)(10,U,2,1,"div",8),a()()),i&2&&(s(5),d("ngIf",r.hayNotificacionesNoLeidas()),s(2),d("ngIf",r.isLoading),s(),d("ngIf",r.errorMessage),s(),d("ngIf",!r.isLoading&&r.notificaciones.length===0),s(),d("ngIf",!r.isLoading&&r.notificaciones.length>0))},dependencies:[w,T,k],styles:[".notificaciones-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px}.notificaciones-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid var(--border-color)}.notificaciones-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text-primary);margin:0;font-size:24px;font-weight:600}.notificaciones-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-marcar-todas[_ngcontent-%COMP%]{background:var(--primary-color);color:#fff;border:none;padding:8px 16px;border-radius:6px;font-size:14px;cursor:pointer;transition:all .3s ease}.notificaciones-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-marcar-todas[_ngcontent-%COMP%]:hover{background:var(--primary-hover)}.notificaciones-content[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%], .notificaciones-content[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;color:var(--text-secondary)}.notificaciones-content[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .notificaciones-content[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px}.notificaciones-content[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{background:rgba(var(--error-color-rgb),.1);color:var(--error-color);padding:12px 16px;border-radius:6px;margin-bottom:16px;font-size:14px}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;padding:16px;margin-bottom:12px;background:var(--card-bg);border:1px solid var(--border-color);border-radius:8px;transition:all .3s ease}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item.no-leida[_ngcontent-%COMP%]{border-left:4px solid var(--primary-color);background:rgba(var(--primary-color-rgb),.05)}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item.leida[_ngcontent-%COMP%]{opacity:.7}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-icon[_ngcontent-%COMP%]{margin-right:16px;flex-shrink:0}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-icon[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:24px;display:block}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]{flex:1;min-width:0}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-header[_ngcontent-%COMP%]{margin-bottom:12px}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-header[_ngcontent-%COMP%]   .mensaje[_ngcontent-%COMP%]{color:var(--text-primary);margin:0 0 4px;font-size:14px;line-height:1.4}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-header[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:12px}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border:none;border-radius:4px;font-size:12px;cursor:pointer;transition:all .3s ease}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]   button.btn-marcar-leida[_ngcontent-%COMP%]{background:var(--success-color);color:#fff}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]   button.btn-marcar-leida[_ngcontent-%COMP%]:hover{background:var(--success-hover)}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]   button.btn-eliminar[_ngcontent-%COMP%]{background:var(--error-color);color:#fff}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]   button.btn-eliminar[_ngcontent-%COMP%]:hover{background:var(--error-hover)}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-status[_ngcontent-%COMP%]{margin-left:12px;flex-shrink:0}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-status[_ngcontent-%COMP%]   .unread-indicator[_ngcontent-%COMP%]{width:8px;height:8px;background:var(--primary-color);border-radius:50%;display:block}@media (max-width: 768px){.notificaciones-container[_ngcontent-%COMP%]{padding:16px}.notificaciones-header[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:flex-start}.notificaciones-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%], .notificaciones-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .btn-marcar-todas[_ngcontent-%COMP%]{width:100%}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]{flex-direction:column}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-icon[_ngcontent-%COMP%]{margin-right:0;margin-bottom:12px}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]   .notificacion-status[_ngcontent-%COMP%]{margin-left:0;margin-top:12px}}"]});let t=c;return t})();export{W as NotificacionesComponent};
